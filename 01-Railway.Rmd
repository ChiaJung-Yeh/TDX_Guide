```{r setup1, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(sf)
library(ggplot2)
library(ggsflabel)
library(ggspatial)
library(knitr)
library(kableExtra)
library(TDX)
library(DT)

app_id = '8f35504e01eb4a43abfd41c920955690'
app_key = 'H9MfljykHDeGiifyr2zKJ0XsKFQ'
```

# **軌道運輸資料**
軌道運輸係指臺鐵、高鐵、捷運與輕軌，其中捷運系統包含臺北捷運、桃園機場捷運、臺中捷運、高雄捷運，輕軌系統含括新北捷運（淡海輕軌）與高雄輕軌。後續的函式中皆須設定營運機構之參數（`operator=`），請參照`TDX_Railway`表格，營運機構名稱與其相對應之代碼臚列如下。  

```{r TDX_Railway, echo=T, eval=F}
TDX_Railway
```

```{r TDX_Railway_table, echo=F, eval=T}
TDX_Railway_temp=TDX_Railway
colnames(TDX_Railway_temp)=c("軌道運輸營運機構","代碼")
kable(TDX_Railway_temp, booktabs=T)%>%
  kable_styling(bootstrap_options=c("striped", "hover"), font_size=14)%>%
  column_spec(1, bold=T)%>%
  row_spec(0, bold=T, color="white", background="#7B7B7B")
```

此外本資料之下載必須利用 API 金鑰，故函式中須輸入`app_id=`與`app_key=`兩參數，亦即在 [1.6.2 API 金鑰申請](#api-金鑰申請)的 APP ID 與 APP Key。  

軌道運輸資料中提供站點、路線站點、路線線型、班表等資料。  


## 軌道站點資料
<font color="#484891" size="4"><u>**◎ 資料概述**</u></font>  
回傳資料為軌道運輸場站的站點屬性資料，欄位包括站點名稱、站點代碼、站點所在城市（縣市、鄉鎮）、經緯度等。  

<font color="#484891" size="4"><u>**◎ 函式參數**</u></font>  
```{r Rail_Station_code, echo=T, eval=F}
Rail_Station(app_id, app_key, operator, dtype="text", out=FALSE)
```

```{r Rail_Station_table, echo=F, eval=T}
TDX_table=data.frame(parameter=c("`app_id=`", "`app_key=`", "`operator=`", rep("`dtype=`", 2), rep("`out=`", 3)),
                     must=c(rep("必填參數", 3), rep("選填參數", 5)),
                     func=c("[金鑰 APP ID]","[金鑰 APP Key]","營運機構代碼", rep("回傳的資料型態", 2), rep("匯出資料之路徑", 3)),
                     details=c("[1.6.2 API 金鑰申請](#api-金鑰申請)的 APP ID","[1.6.2 API 金鑰申請](#api-金鑰申請)的 APP Key","請參照`TDX_Railway`表格","`text`：純文字形式，其資料型態屬`data.frame` [**預設值**]","`sf`：地理資料形式，其資料型態屬`sf`","`FALSE`：不匯出資料至本機 [**預設值**]" ,"若回傳的資料型態為「`text`」：路徑必須含有`.csv`或`.txt`", "若回傳的資料型態為「`sf`」：路徑必須含有`.shp`"))

colnames(TDX_table)=c("參數","必選填","功能","參數設定值")

kable(TDX_table, booktabs=T)%>%
  kable_styling(bootstrap_options=c("striped", "hover"), font_size=14)%>%
  column_spec(1, bold=T)%>%
  column_spec(1:4, background="white")%>%
  row_spec(0, bold=T, color="white", background="#8E8E8E")%>%
  collapse_rows(columns=c(1:3))
```

<font color="#484891" size="4"><u>**◎ 程式碼撰寫範例**</u></font>  

**1. 回傳高鐵站點資料（純文字）**
```{r Rail_Station_code1, echo=T, eval=T, message=F, warning=F}
# 介接高鐵站點資料
THSR_station=Rail_Station(app_id, app_key, "THSR")
```

```{r Rail_Station_code2, echo=T, eval=F, message=F, warning=F}
# 查看THSR_station資料
THSR_station
```

```{r Rail_Station_code3, echo=F, eval=T, message=F, warning=F}
# 介接高鐵站點資料
datatable(THSR_station, options=list(pageLength=5, scrollX=T,
                                    headerCallback = DT::JS(
    "function(thead) {",
    "  $(thead).css('font-size', '0.7em');",
    "}"
  )))%>%
  formatStyle(columns=c(1:8), fontSize='80%')%>%
  formatRound(c("PositionLon", "PositionLat"), digits=4)
```

<br></br>
**2. 回傳臺北捷運站點資料（地理資料）**
```{r Rail_Station_code4, echo=T, eval=T, message=F, warning=F}
# 介接臺北捷運鐵站點資料
TRTC_station=Rail_Station(app_id, app_key, "TRTC", dtype="sf")
```

```{r Rail_Station_code5, echo=T, eval=F, message=F, warning=F}
# 查看TRTC_station資料
TRTC_station
```

```{r Rail_Station_code6, echo=F, eval=T, message=F, warning=F}
# 介接高鐵站點資料
datatable(TRTC_station, options=list(pageLength=5, scrollX=T,
                                    headerCallback = DT::JS(
    "function(thead) {",
    "  $(thead).css('font-size', '0.7em');",
    "}"
  )))%>%
  formatStyle(columns=c(1:8), fontSize='80%')%>%
  formatRound(c("PositionLon", "PositionLat"), digits=4)
```

```{r Rail_Station_code7, echo=T, eval=T, message=F, warning=F}
# TRTC_station繪圖
ggplot()+
  geom_sf(data=TRTC_station)+
  theme_void()
```

:::notice
<font size="4">**NOTE**</font>  
關於 R 語言地圖繪製方式，請參考 [Spatial Analysis with R (Chia Jung, Yeh) 第三章](https://chiajung-yeh.github.io/Spatial-Analysis/data-visualization-with-maps.html)
:::


## 軌道路線站點資料



## 軌道路線線型資料



## 軌道班表資料




